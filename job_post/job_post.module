<?php

/**
 * @file
 * This module provides a node type called job post.
 */

/**
 * Implements hook_node_info().
 */
function job_post_node_info() {
  $node_type = array(
    'job_post' => array(
      'name' => t('Job Post'),
      'base' => 'job_post',
      'description' => t('Use this content type to post a job.'),
      'has_title' => TRUE,
      'title_label' => t('Job Title'),
      'help' => t('Enter the job title,
        job description, and the name of the company that posted the job.'),
    ),
  );

  return $node_type;
}


/**
 * Implements hook_menu_alter().
 *
 * This seems to be stupid. The hook is called when menu is built, so
 * it would make sense if user with no 'administer nodes' permission
 * invoked menu rebuilding, but then also root wouldn't see the
 * menu item.
 */
function job_post_menu_alter(&$items) {
  // dpm($items['node/add/job-post']);
  if (!user_access('administer nodes')) {
    // If the user does not have 'administer nodes' permission,
    // disable the job_post menu item by setting its access callback to FALSE.
    $items['node/add/job-post']['access callback'] = FALSE;
    // Must unset access arguments or Drupal will use user_access()
    // as a default access callback.
    unset($items['node/add/job-post']['access arguments']);
  }
  // dpm($items);
}

/**
 * Implements hook_permission().
 *
 * The standard node access permissions are already created by Drupal
 * and these are processed during node access cases.
 */
function job_post_permission() {
  $permissions = array(
    'pdd create job post' => array(
      'title' => t('PDD Create a job post'),
      'description' => t('PDD Create a job post'),
    ),
    'pdd edit own job post' => array(
      'title' => t('PDD Edit own job post'),
      'description' => t('PDD Edit your own job posting'),
    ),
    'pdd edit any job post' => array(
      'title' => t('PDD Edit any job post'),
      'description' => t('PDD Edit any job posting'),
    ),
    'pdd delete own job post' => array(
      'title' => t('PDD Delete own job post'),
      'description' => t('PDD Delete own job posting'),
    ),
    'pdd delete any job post' => array(
      'title' => t('PDD Delete any job post'),
      'description' => t('PDD Delete any job posting'),
    ),
  );

  //dpm($permissions);

  return $permissions;
}
